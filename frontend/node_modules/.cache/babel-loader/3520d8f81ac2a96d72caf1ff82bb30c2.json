{"ast":null,"code":"import _toConsumableArray from\"/Users/anastasiiaandreeva/Desktop/Yandex.Practikum/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/anastasiiaandreeva/Desktop/Yandex.Practikum/dev/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import Header from\"./Header\";import Main from\"./Main\";import Footer from\"./Footer\";import PopupWithForm from\"./PopupWithForm\";import{useState}from\"react\";import ImagePopup from\"./ImagePopup\";import React from\"react\";import{api}from\"../utils/Api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import{Redirect,Route,Switch,useHistory}from\"react-router-dom\";import Login from\"./Login\";import Register from\"./Register\";import ProtectedRoute from\"./ProtectedRoute\";import*as siteAuth from\"../utils/siteAuth\";import InfoTooltip from\"./InfoTooltip\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditAvatarPopupOpen=_useState2[0],setAvatarModalIsOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isEditProfilePopupOpen=_useState4[0],setEditProfileModalIsOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isAddPlacePopupOpen=_useState6[0],setAddPlaceModalIsOpen=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),selectedCard=_useState8[0],setSelectedCard=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),currentUser=_useState10[0],setCurrentUser=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),cards=_useState12[0],setNewCards=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),loggedIn=_useState14[0],setLoggedIn=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),email=_useState16[0],setEmail=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isSuccessful=_useState18[0],setIsSuccessful=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isInfoToolTipPopup=_useState20[0],setInfoToolTipPopup=_useState20[1];var history=useHistory();React.useEffect(function(){api.getUserData().then(function(res){setCurrentUser(res);}).catch(function(err){console.log(err);});},[]);React.useEffect(function(){api.getInitialCards().then(function(res){setNewCards(res);}).catch(function(err){console.log(err);});},[]);var handleEditAvatarClick=function handleEditAvatarClick(){setAvatarModalIsOpen(true);};var handleEditProfileClick=function handleEditProfileClick(){setEditProfileModalIsOpen(true);};var handleAddPlaceClick=function handleAddPlaceClick(){setAddPlaceModalIsOpen(true);};var handleCardClick=function handleCardClick(card){setSelectedCard(card);};var handleAddPlaceSubmit=function handleAddPlaceSubmit(card){api.addCard(card).then(function(newCard){setNewCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});};var handleCardLike=function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){setNewCards(function(cards){return cards.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});};var handleCardDelete=function handleCardDelete(card){api.deleteCard(card._id).then(function(){setNewCards(function(cards){return cards.filter(function(c){return c._id!==card._id;});});}).catch(function(err){console.log(err);});};var closeAllPopups=function closeAllPopups(){setAvatarModalIsOpen(false);setEditProfileModalIsOpen(false);setAddPlaceModalIsOpen(false);setSelectedCard(null);setInfoToolTipPopup(false);};var handleUpdateUser=function handleUpdateUser(data){api.editProfile(data).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(err);});};function handleUpdateAvatar(_ref){var avatar=_ref.avatar;api.editAvatar(avatar).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(err);});}function handleToken(){var jwt=localStorage.getItem('jwt');if(jwt){siteAuth.checkToken(jwt).then(function(res){if(res){setLoggedIn(true);setEmail(res.data.email);}}).catch(function(err){console.log(err);});}}React.useEffect(function(){handleToken();},[]);React.useEffect(function(){if(loggedIn){history.push('/');}},[loggedIn]);var handleLogin=function handleLogin(_ref2){var password=_ref2.password,email=_ref2.email;siteAuth.signIn({password:password,email:email}).then(function(res){localStorage.setItem('jwt',res.token);handleToken();setEmail(email);setIsSuccessful(true);}).catch(function(err){console.log(err);setInfoToolTipPopup(true);setIsSuccessful(false);});};var handleRegister=function handleRegister(_ref3){var password=_ref3.password,email=_ref3.email;siteAuth.signUp({password:password,email:email}).then(function(res){setIsSuccessful(true);setInfoToolTipPopup(true);history.push('sign-in');}).catch(function(err){console.log(err);setIsSuccessful(false);setInfoToolTipPopup(true);});};function signOut(){localStorage.removeItem('jwt');history.push('/sign-in');setLoggedIn(false);}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:email,onSignOut:signOut}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{handleRegister:handleRegister})}),/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddCard:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups,name:\"open-photo\"}),/*#__PURE__*/_jsx(PopupWithForm,{title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",name:\"delete-card\",button:\"\\u0414\\u0430\"})]}),/*#__PURE__*/_jsx(InfoTooltip,{isSuccessful:isSuccessful,onClose:closeAllPopups,isOpen:isInfoToolTipPopup})]})});}export default App;","map":{"version":3,"sources":["/Users/anastasiiaandreeva/Desktop/Yandex.Practikum/dev/react-mesto-auth/src/components/App.js"],"names":["Header","Main","Footer","PopupWithForm","useState","ImagePopup","React","api","CurrentUserContext","EditProfilePopup","EditAvatarPopup","AddPlacePopup","Redirect","Route","Switch","useHistory","Login","Register","ProtectedRoute","siteAuth","InfoTooltip","App","isEditAvatarPopupOpen","setAvatarModalIsOpen","isEditProfilePopupOpen","setEditProfileModalIsOpen","isAddPlacePopupOpen","setAddPlaceModalIsOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setNewCards","loggedIn","setLoggedIn","email","setEmail","isSuccessful","setIsSuccessful","isInfoToolTipPopup","setInfoToolTipPopup","history","useEffect","getUserData","then","res","catch","err","console","log","getInitialCards","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleAddPlaceSubmit","addCard","newCard","closeAllPopups","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","map","c","handleCardDelete","deleteCard","filter","handleUpdateUser","data","editProfile","handleUpdateAvatar","avatar","editAvatar","handleToken","jwt","localStorage","getItem","checkToken","push","handleLogin","password","signIn","setItem","token","handleRegister","signUp","signOut","removeItem"],"mappings":"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","sourcesContent":["import Header from \"./Header\";\nimport Main from \"./Main\";\nimport Footer from \"./Footer\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport {useState} from \"react\";\nimport ImagePopup from \"./ImagePopup\";\nimport React from \"react\";\nimport {api} from \"../utils/Api\";\nimport {CurrentUserContext} from \"../contexts/CurrentUserContext\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport {Redirect, Route, Switch, useHistory} from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport * as siteAuth from \"../utils/siteAuth\";\nimport InfoTooltip from \"./InfoTooltip\";\n\nfunction App() {\n\n  const [isEditAvatarPopupOpen, setAvatarModalIsOpen] = useState(false);\n  const [isEditProfilePopupOpen, setEditProfileModalIsOpen] = useState(false);\n  const [isAddPlacePopupOpen, setAddPlaceModalIsOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [currentUser, setCurrentUser] = useState({});\n  const [cards, setNewCards] = useState([]);\n  const [loggedIn, setLoggedIn] = useState(false);\n  const [email, setEmail] = useState('');\n  const [isSuccessful, setIsSuccessful] = useState(false);\n  const [isInfoToolTipPopup, setInfoToolTipPopup] = useState(false)\n  const history = useHistory();\n\n  React.useEffect(() => {\n    api.getUserData()\n      .then((res) => {\n        setCurrentUser(res)\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }, [])\n\n  React.useEffect(() => {\n    api.getInitialCards()\n      .then((res) => {\n        setNewCards(res)\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }, [])\n\n  const handleEditAvatarClick = () => {\n    setAvatarModalIsOpen(true);\n  }\n\n  const handleEditProfileClick = () => {\n    setEditProfileModalIsOpen(true);\n  }\n\n  const handleAddPlaceClick = () => {\n    setAddPlaceModalIsOpen(true);\n  }\n\n  const handleCardClick = (card) => {\n    setSelectedCard(card)\n  }\n\n  const handleAddPlaceSubmit = (card) => {\n    api.addCard(card)\n      .then((newCard) => {\n        setNewCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }\n\n  const handleCardLike = (card) => {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeCardStatus(card._id, !isLiked)\n      .then((newCard) => {\n        setNewCards((cards) => cards.map((c) => c._id === card._id ? newCard : c));\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }\n\n  const handleCardDelete = (card) => {\n    api.deleteCard(card._id)\n      .then(() => {\n        setNewCards((cards) => cards.filter((c) => c._id !== card._id))\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }\n\n  const closeAllPopups = () => {\n    setAvatarModalIsOpen(false);\n    setEditProfileModalIsOpen(false);\n    setAddPlaceModalIsOpen(false);\n    setSelectedCard(null)\n    setInfoToolTipPopup(false)\n  }\n\n  const handleUpdateUser = (data) => {\n    api.editProfile(data)\n      .then((res) => {\n        setCurrentUser(res)\n        closeAllPopups()\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }\n\n  function handleUpdateAvatar({avatar}) {\n    api.editAvatar(avatar)\n      .then((res) => {\n        setCurrentUser(res)\n        closeAllPopups()\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n  }\n\n  function handleToken() {\n    const jwt = localStorage.getItem('jwt');\n    if(jwt) {\n      siteAuth.checkToken(jwt)\n        .then((res) => {\n          if(res) {\n            setLoggedIn(true);\n            setEmail(res.data.email);\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        })\n    }\n  }\n\n  React.useEffect(() => {\n    handleToken()\n  },[])\n\n  React.useEffect(() => {\n    if(loggedIn) {\n      history.push('/')\n    }\n  }, [loggedIn])\n\n  const handleLogin = ({password, email}) => {\n    siteAuth.signIn({password, email})\n      .then((res) => {\n        localStorage.setItem('jwt', res.token);\n        handleToken()\n        setEmail(email)\n        setIsSuccessful(true)\n      })\n      .catch((err) => {\n        console.log(err)\n        setInfoToolTipPopup(true)\n        setIsSuccessful(false)\n      })\n  }\n\n  const handleRegister = ({password, email }) => {\n    siteAuth.signUp({password, email})\n      .then((res) => {\n        setIsSuccessful(true)\n        setInfoToolTipPopup(true)\n        history.push('sign-in')\n      })\n      .catch((err) => {\n        console.log(err)\n        setIsSuccessful(false)\n        setInfoToolTipPopup(true)\n      })\n  }\n\n  function signOut() {\n    localStorage.removeItem('jwt');\n    history.push('/sign-in');\n    setLoggedIn(false)\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <div className=\"container\">\n          <Header loggedIn={loggedIn} email={email} onSignOut={signOut}/>\n          <Switch>\n            <Route path='/sign-in'>\n              <Login handleLogin={handleLogin} />\n            </Route>\n            <Route path='/sign-up'>\n              <Register handleRegister={handleRegister}/>\n            </Route>\n            <ProtectedRoute exact path='/'\n                            loggedIn={loggedIn}\n                            component={Main}\n                            onEditAvatar={handleEditAvatarClick}\n                            onEditProfile={handleEditProfileClick}\n                            onAddPlace={handleAddPlaceClick}\n                            onCardClick={handleCardClick}\n                            onCardLike={handleCardLike}\n                            onCardDelete={handleCardDelete}\n                            cards={cards}/>\n            <Route>\n              {loggedIn ? <Redirect to='/' /> : <Redirect to='/sign-in'/>}\n            </Route>\n          </Switch>\n          <Footer/>\n          {/*Popup Edit Profile*/}\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n          />\n          {/*Add card popup*/}\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddCard={handleAddPlaceSubmit}\n          />\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n          />\n          {/*Окно фото*/}\n          <ImagePopup\n            card={selectedCard}\n            onClose={closeAllPopups}\n            name=\"open-photo\"\n          />\n          {/*Окно удаления карточки*/}\n          <PopupWithForm\n            title=\"Вы уверены?\"\n            name=\"delete-card\"\n            button=\"Да\"\n          />\n        </div>\n        <InfoTooltip\n          isSuccessful={isSuccessful}\n          onClose={closeAllPopups}\n          isOpen={isInfoToolTipPopup}\n        />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}